## ğŸ“‘ ì´ë¯¸ì§€ ì €ì‘ê¶Œ ì¸ì¦ ëŒ€í–‰ ì„œë¹„ìŠ¤ ê¸°íš ë³´ê³ ì„œ v2  
> **ì—…ë°ì´íŠ¸ í•µì‹¬** â€” ëª¨ë“  ì¦ë¹™ ìë£Œë¥¼ â€œEvidence JSON + JWS í† í°â€ í•˜ë‚˜ë¡œ íŒ¨í‚¤ì§•

---

### 1. ì„œë¹„ìŠ¤ ê°€ì¹˜

| ë¬¸ì œ | í•´ê²° ë°©ì•ˆ |
|------|-----------|
| ì´ë¯¸ì§€ ì†Œìœ  ì‹œì  ì¦ëª… ì–´ë ¤ì›€ | **ë¸”ë¼ì¸ë“œ ì›Œí„°ë§ˆí¬**ë¡œ ì†Œìœ ì ì‹ë³„ ì •ë³´ ì‚½ì… |
| â€œì–¸ì œ ë“±ë¡í–ˆë‚˜â€ ì…ì¦ | **RFC 3161 íƒ€ì„ìŠ¤íƒ¬í”„(TSA)**ë¡œ ë²•ì  ì‹œì  ê³ ì • |
| ìë£Œ ê´€ë¦¬ ë³µì¡ | ì›Œí„°ë§ˆí¬Â·TSQÂ·TSRÂ·ì¸ì¦ì„œë¥¼ **Evidence JSON â†’ JWS**ë¡œ ë¬¶ì–´ ë¬¸ìì—´ í•˜ë‚˜ë¡œ ì „ë‹¬Â·ë³´ì¡´ |

---

### 2. ì²˜ë¦¬ íë¦„ ìš”ì•½

```
(1) íšŒì›ê°€ì…             -> api_key ë°œê¸‰
(2) í‚¤ êµí™˜              -> ì„œë²„Â·ì‚¬ìš©ì RSA í‚¤, ì›Œí„°ë§ˆí¬ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
(3) ì´ë¯¸ì§€ ì—…ë¡œë“œ        -> crypto_package ê²€ì¦, ì›Œí„°ë§ˆí¬ ì‚½ì…
(4) íƒ€ì„ìŠ¤íƒ¬í”„ íšë“      -> TSQ â†’ TSA â†’ TSR ìˆ˜ì‹ Â·ê²€ì¦
(5) Evidence JSON ì‘ì„±   -> JWS(RS256) ì„œëª…
(6) ê²°ê³¼ ë°˜í™˜            -> watermarked_image + evidence_jws
```

---

### 3. í•µì‹¬ ë°ì´í„° êµ¬ì¡°

#### 3-1. Evidence JSON (payload)
```jsonc
{
  "iss": "copyright-server.example",
  "sub": "alice",
  "iat": 1714024800,
  "version": "1.0",
  "evidence": {
    "file_sha256": "ab34â€¦",
    "file_size": 512034,
    "wm_algorithm": "blind_watermark-v1",
    "wm_text": "Owned by alice â€¦",
    "image_url": "s3://â€¦/watermarked_x.jpg",
    "timestamp": {
      "tsq": "<Base64-DER>",
      "tsr": "<Base64-DER>",
      "tsa_chain": "<PEM bundle>",
      "gen_time": "2025-04-25T11:22:33Z"
    }
  }
}
```

#### 3-2. JWS Compact í† í°
```
BASE64URL(header).BASE64URL(payload).BASE64URL(signature)
```
* header ì˜ˆ: `{"alg":"RS256","typ":"JWT","kid":"2025-04"}`  
* signature: **ì„œë²„ ê°œì¸í‚¤**ë¡œ RS256 ì„œëª…  
â†’ ê²°ê³¼ ê¸¸ì´ 2-4 KB.

---

### 4. ì£¼ìš” API ì„¤ê³„

| ë‹¨ê³„ | ë©”ì„œë“œ & ê²½ë¡œ | ì…ë ¥ | ì£¼ìš” ë¡œì§ | ì¶œë ¥ |
|------|--------------|------|-----------|------|
| ì‚¬ìš©ì ë“±ë¡ | **POST** `/api/v1/user` | `user_id` | api_key ìƒì„± | `{user_id, api_key}` |
| í‚¤ êµí™˜ | **PUT** `/api/v1/user/{id}` | `app_key`, `user_public_key`, `password_img`, `password_wm` | ì‚¬ìš©ì ê²€ì¦, ë¹„ë²ˆÂ·ê³µê°œí‚¤ ì €ì¥, **ì„œë²„ ê³µê°œí‚¤** ë°˜í™˜ | `{sp_public_key}` |
| ì›Œí„°ë§ˆí¬ ë“±ë¡ | **POST** `/api/v1/watermark` | `image`, `user_id`, `crypto_package` | crypto_package ê²€ì¦ â†’ ì›Œí„°ë§ˆí¬ ì‚½ì… â†’ TSA í˜¸ì¶œ â†’ Evidence JSON â†’ **JWS ì„œëª…** | `{image_url, evidence_jws}` |
| ì›Œí„°ë§ˆí¬ ì¶”ì¶œ | **POST** `/api/v1/extract-watermark` | `image`, `user_id` | ë¹„ë°€ë²ˆí˜¸Â·ê¸¸ì´ë¡œ ì¶”ì¶œ | `{watermark_text}` |

---

### 5. ë³´ì•ˆÂ·ì»´í”Œë¼ì´ì–¸ìŠ¤

| ê³„ì¸µ | ì ìš© |
|------|------|
| ì „ì†¡ | API TLS 1.3, presigned URL ì œí•œ ë©”ì„œë“œ |
| ì €ì¥ | S3 Object Lock(Compliance), ì„œë²„ ê°œì¸í‚¤ â†’ HSM/KMS |
| ì•”í˜¸Â·ì„œëª… | RSA-OAEP, AES-256-GCM, RSA-PSS, JWS-RS256 |
| ê²€ì¦ | íŒŒì¼ SHA-256 ëŒ€ì¡° + TSR ê²€ì¦ + JWS ê³µê°œí‚¤ ê²€ì¦ |
| í‚¤ ìœ í†µ | `/jwks.json` JWKS, `kid` ë²„ì „Â·ë¡¤ë§ ì§€ì› |

---

### 6. ì‚¬ìš©ìÂ·ì œ3ì ê²€ì¦ ì ˆì°¨

1. Evidence JWS ìˆ˜ì‹   
2. JWKS URLì—ì„œ ì„œë²„ ê³µê°œí‚¤ íšë“  
3. JWS ì„œëª… ê²€ì¦ â†’ ë³€ì¡° ì—¬ë¶€ í™•ì¸  
4. payload ì—´ëŒ â†’ ì´ë¯¸ì§€ SHA-256, TSA gen_time ë“± í™•ì¸  
5. í•„ìš” ì‹œ TSR DERì„ `openssl ts -verify` ë¡œ ë…ë¦½ ê²€ì¦

*(ì˜µì…˜) ê¸°ë°€ì„± í•„ìš” ì‹œ* â€” Evidence JSONì„ ë¨¼ì € JWE(A256GCM)ë¡œ ì•”í˜¸í™”í•œ ë’¤ JWS ì„œëª… â†’ ì—´ëŒí•˜ë ¤ë©´ ìˆ˜ì‹ ì ê°œì¸í‚¤ë¡œ ë³µí˜¸í™” í›„ 2-4ë‹¨ê³„ ì§„í–‰.

---

### 7. ì¥ì  ìš”ì•½

| êµ¬ë¶„ | íš¨ê³¼ |
|------|------|
| **ë‹¨ì¼ í† í°** | ì˜¤í”„ë¼ì¸ ì œì‹œÂ·ë²•ì› ì œì¶œì´ ê°„ë‹¨ (QRÂ·í…ìŠ¤íŠ¸ë¡œë„ ì „ë‹¬) |
| **í‘œì¤€ JOSE** | ì–¸ì–´Â·í”Œë«í¼ ë¶ˆë¬¸ ê²€ì¦, ë¼ì´ë¸ŒëŸ¬ë¦¬ í’ë¶€ |
| **ë¬´ê²°ì„± + ë°œí–‰ì ì¦ëª…** | ì„œë²„ ê°œì¸í‚¤ ì„œëª… â†’ ê³µê°œí‚¤ë§Œìœ¼ë¡œ ê²€ì¦ |
| **í™•ì¥ì„±** | ë‹¤ì¤‘ TSA, ì¶”ê°€ ë©”íƒ€, ì•Œê³ ë¦¬ì¦˜ êµì²´(JWS header) ì‰½ê²Œ í™•ì¥ |

---

### 8. ë‹¤ìŒ ë‹¨ê³„

1. **PoC**  
   - `python-jose`ë¡œ JWS ìƒì„±/ê²€ì¦ ë¡œì§ êµ¬í˜„  
   - Evidence JSON êµ¬ì¡° ì²´ê³„í™”(ë²„ì „ í•„ë“œ í¬í•¨)
2. **ì¸í”„ë¼**  
   - JWKS ìë™ ë¡¤ë§Â·ë°°í¬ íŒŒì´í”„ë¼ì¸  
   - Object Lock ë²„í‚·Â·Lifecycle ì •ì±… ì„¤ì •
3. **Dashboard / SDK**  
   - ì‚¬ìš©ì ì›Œí„°ë§ˆí¬ ì´ë ¥ í‘œì¶œ, ì¦ë¹™ ë‹¤ìš´ë¡œë“œ  
   - ëª¨ë°”ì¼Â·ì›¹ SDKë¡œ ì¦‰ì‹œ ì¸ì¦

---

> ì´ ì„¤ê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ MVP ê°œë°œì„ ì§„í–‰í•˜ê³ , ì„¸ë¶€ ìŠ¤í™(íŒŒì¼ í¬ê¸° ì œí•œ, ê³¼ê¸ˆ ëª¨ë¸ ë“±)ì€ ë³„ë„ ë¬¸ì„œë¡œ ì •ì˜í•˜ë©´ ë©ë‹ˆë‹¤. ì¶”ê°€ ë¬¸ì˜ í™˜ì˜í•©ë‹ˆë‹¤!